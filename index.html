<script>

// ====== BASİT SHA256 ŞİFRELEME ======
async function hash(text){
const encoder = new TextEncoder();
const data = encoder.encode(text);
const hashBuffer = await crypto.subtle.digest("SHA-256", data);
const hashArray = Array.from(new Uint8Array(hashBuffer));
return hashArray.map(b => b.toString(16).padStart(2,"0")).join("");
}

// ====== DATABASE ======
let users = JSON.parse(localStorage.getItem("users") || "[]");

// ====== REGISTER ======
async function register(){

let nick = prompt("Minecraft Nick:");
let pass = prompt("Şifre:");

if(!nick || !pass) return alert("Boş bırakılamaz");

if(users.find(u => u.nick.toLowerCase() === nick.toLowerCase())){
return alert("Bu nick zaten kayıtlı!");
}

let hashed = await hash(pass);

users.push({
nick: nick,
password: hashed,
role: "user"
});

localStorage.setItem("users", JSON.stringify(users));
alert("Kayıt başarılı!");
}

// ====== LOGIN ======
async function login(){

let nick = prompt("Nick:");
let pass = prompt("Şifre:");

let user = users.find(u => u.nick.toLowerCase() === nick.toLowerCase());
if(!user) return alert("Kullanıcı yok!");

let hashed = await hash(pass);

if(user.password !== hashed){
return alert("Şifre yanlış!");
}

localStorage.setItem("loggedIn", JSON.stringify(user));
alert("Giriş başarılı!");
checkLogin();
}

// ====== ADMIN PANEL ======
function adminPanel(){

let user = JSON.parse(localStorage.getItem("loggedIn") || "null");

if(!user || user.role !== "admin"){
return alert("Yetkin yok!");
}

let list = users.map(u => u.nick + " (" + u.role + ")").join("\n");
alert("Kayıtlı Kullanıcılar:\n\n" + list);
}

// ====== LOGOUT ======
function logout(){
localStorage.removeItem("loggedIn");
checkLogin();
}

// ====== LOGIN STATE ======
function checkLogin(){
let user = JSON.parse(localStorage.getItem("loggedIn") || "null");

if(user){
document.getElementById("welcome").innerText = "Hoşgeldin " + user.nick;
document.getElementById("welcome").style.display = "block";
}else{
document.getElementById("welcome").style.display = "none";
}
}

checkLogin();

// ====== İLK ADMIN OLUŞTUR ======
if(!users.find(u => u.role === "admin")){
users.push({
nick:"admin",
password:"240be518fabd2724ddb6f04eeb8e5a03", // şifre: 1234 (hash)
role:"admin"
});
localStorage.setItem("users", JSON.stringify(users));
}

</script>
